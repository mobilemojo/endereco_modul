function StandardAddressCheck(e){function n(e){function n(){r.setAddressCheckNeeded(!0)}function i(){for(var e=0;e<E.IsAddressCheckNeededListener.length;e++)if(E.IsAddressCheckNeededListener[e]())return!0;return!1}function s(){if(r.isAddressCheckNeeded()){var e=E.$.Event("validate");r.trigger(e),e.isDefaultPrevented()||E.ValidationIsRunning||(E.ValidationIsRunning=!0,a())}}function a(){m.attr("disabled",!0),C.validate()}function d(n){for(var t=e.postCode.node.val(),o=e.city.node.val(),r=e.street.node.val(),i=e.streetNr.node.val(),s=0;s<n.length;s++)if(t!==n[s].postCode||o!==n[s].city||r!==n[s].street||i!==n[s].houseNumber)return!0;return!1}function u(n){var t,o,i=0,s=c(A,e.postCode.node.val(),e.city.node.val(),e.street.node.val(),e.streetNr.node.val(),i);for(g=0,s.find("input").attr("checked",!0),S.html(""),S.append(s),h.html(""),i=0;i<n.elements.length;i++)t=n.elements[i],l(t)&&(o=c(N,t.postCode,t.city,t.street,t.houseNumber,i+1),h.append(o),g++);0==g?v.addClass("no-corrections-found"):v.removeClass("no-corrections-found");var a=E.$.Event("setupPopup");r.trigger(a)}function l(e){return"string"==typeof e.postCode&&e.postCode.length>0||"string"==typeof e.city&&e.city.length>0||"string"==typeof e.street&&e.street.length>0||"string"==typeof e.houseNumber&&e.houseNumber.length>0}function c(e,n,t,o,r,i){var s=Mustache.render(e,{postCode:n,city:t,street:o,streetNumber:r,id:i});return E.$(s)}function f(){var n,o=E.$("input[name=addressCorrection]:checked").data("id");o>0&&(n=T[o-1],n&&(e.postCode.node.val(n.postCode),e.city.node.val(n.city),e.street.node.val(n.street),e.streetNr.node.val(n.houseNumber),t([{node:e.postCode.node,value:n.postCode},{node:e.city.node,value:n.city},{node:e.street.node,value:n.street},{node:e.streetNr.node,value:n.houseNumber}]))),v.modal("hide"),!i()&&g>0&&_.submit()}if("string"==typeof e.pathToAccountingController&&e.postCode&&e.postCode.node&&e.city&&e.city.node&&e.street&&e.street.node&&e.streetNr&&e.streetNr.node&&e.saveButton&&e.saveButton.node&&e.form&&e.form.node){var p,C,g,v=E.$("#enderecoAddressCheckModal"),S=E.$("#enderecoCurrentInput"),h=E.$("#enderecoCorrectedSuggestions"),y=E.$("#enderecoCorrectAddressButton"),A=E.$("#enderecoCurrentTypeTemplate").html(),N=E.$("#enderecoCorrectionTypeTemplate").html(),m=e.saveButton.node,O="boolean"==typeof E.Validation.checkUnchangedAddresses&&E.Validation.checkUnchangedAddresses,T=[],_=e.form.node,D=!1;r.isAddressCheckNeeded=function(){if(D)return!1;var e=o();return!!e&&O},r.setAddressCheckNeeded=function(e){O=e},r.disableAddressCheck=function(){D=!0},r.enableAddressCheck=function(){D=!1},E.ValidationIsRunning=!1,E.IsAddressCheckNeededListener=E.IsAddressCheckNeededListener?E.IsAddressCheckNeededListener:[],E.IsAddressCheckNeededListener.push(function(){return r.isAddressCheckNeeded()}),e.postCode.node.keyup(n),e.city.node.keyup(n),e.street.node.keyup(n),e.streetNr.node.keyup(n),E.$(document).ready(function(){setTimeout(function(){_.on("submit",function(e){e.isDefaultPrevented()?e.enderecoPreventedDefault&&(i()&&(e.preventDefault(),e.enderecoPreventedDefault=!0),s()):(i()&&(e.preventDefault(),e.enderecoPreventedDefault=!0),s())})},10)});var I=function(n){E.log.info("Doing accounting now.");var t={service:"accountingTrigger",fieldId:"isserviceused"},o="function"==typeof n?n:function(){},r=JSON.stringify(t);E.$.ajax({type:"POST",url:E.getCommunicationService().getServerUri()+e.pathToAccountingController,data:{orwellServiceData:r},async:!1}).done(function(e){E.log.info("Accounting successful.")}).fail(function(e){E.log.error("Accounting was not successful.")}).always(function(e){o()})};p=function(e){r.setAddressCheckNeeded(!1),m.attr("disabled",!1),E.ValidationIsRunning=!1;var n=!1;d(e.elements)?(e.elements.sort(function(e,n){return parseFloat(e.fuzzyValue)<parseFloat(n.fuzzyValue)}),e.elements=e.elements.splice(0,5),u(e),T=e.elements,y.one("click",f),v.modal("show")):n=!0,I(function(){n&&E.submitForm(_[0])})},v.on("hidden.bs.modal",function(){var e=E.$.Event("closedPopup");r.trigger(e),y.off("click"),s()}),C=new E.ValidationField({value:"",validationType:new E.Validation.AddressCheck(function(){return e.postCode.node.val()},function(){return e.city.node.val()},function(){return e.street.node.val()},function(){return e.streetNr.node.val()}),onValidation:p})}else E.log.debug("Could not initialize StandardAddressCheck, one ore more of the required fields/nodes were missing.")}var t,o,r=E.$(this);return o=e.country&&"function"==typeof e.country.isValidCountry?e.country.isValidCountry:function(){return!0},t="function"==typeof e.valueSetCallback?e.valueSetCallback:function(){},n(e),r}function StandardInputAssistant(e){function n(e){if(e.firstName&&e.firstName.node&&e.gender&&e.gender.node&&"function"==typeof e.gender.isMale&&"function"==typeof e.gender.isFemale){e.gender.nodeForErrorClass||(e.gender.nodeForErrorClass=e.gender.node);var n=function(n){for(var t=n.statuses,o=E.Validation.FirstNameCheckStatus,r=0;r<t.length;r++)switch(t[r]){case o.FIRST_NAME_FOUND:break;case o.FIRST_NAME_NOT_FOUND:e.gender.nodeForErrorClass.removeClass("gender-mismatch");break;case o.FIRST_NAME_IS_FEMALE:e.gender.isMale(e.gender.node)?e.gender.nodeForErrorClass.addClass("gender-mismatch"):e.gender.nodeForErrorClass.removeClass("gender-mismatch");break;case o.FIRST_NAME_IS_MALE:e.gender.isFemale(e.gender.node)?e.gender.nodeForErrorClass.addClass("gender-mismatch"):e.gender.nodeForErrorClass.removeClass("gender-mismatch")}},t=new E.ValidationField({value:e.firstName.node.val(),validationType:new E.Validation.FirstNameCheck(function(){return e.firstName.node.val()},0),onValidation:n});e.gender.changeTrigger(function(){t.validate()},e.gender.node),e.firstName.node.on("blur",function(){t.setValue(e.gender.node.val()),t.validate()})}else E.log.warn("Could not initialize Gender check, one or more fields or necessary callbacks are missing.")}function t(e){if(e.postCode&&e.postCode.node&&e.city&&e.city.node){var n=function(e){for(var n=(e.statuses,E.Validation.PostCodeExpansionStatus,[]),t=0;t<e.elements.length;t++)n.push(e.elements[t].postCode+"\t"+e.elements[t].city);return n},t=function(n){var t=n.text,o=t.split("\t");e.postCode.node.val(o[0]),e.city.node.val(o[1]),i([{node:e.postCode.node,value:o[0]},{node:e.city.node,value:o[1]}])},o=new E.UI.InputFieldSuggest(e.postCode.node,n,function(e){return new E.Validation.PostCodeExpansion(e)},t),s=new E.UI.InputFieldSuggest(e.city.node,n,function(e){return new E.Validation.CityExpansion(e)},t),a=o.validationBehaviour;o.validationBehaviour=function(e,n,t){r()&&a(e,n,t)};var d=s.validationBehaviour;s.validationBehaviour=function(e,n,t){r()&&d(e,n,t)}}else E.log.warn("Could not initialize postCode and City expansion, one or more fields/nodes were missing.")}function o(e){if(e.street&&e.street.node&&e.postCode&&e.postCode.node&&e.city&&e.city.node){var n=function(e){for(var n=(e.statuses,E.Validation.PostCodeExpansionStatus,[]),t=0;t<e.elements.length;t++)n.push(e.elements[t].street);return n},t=function(n){e.street.node.val(n.text),i([{node:e.street.node,value:n.text}])},o=new E.UI.InputFieldSuggest(e.street.node,n,function(n){return new E.Validation.StreetExpansion(n,function(){return e.postCode.node.val()},function(){return e.city.node.val()})},t),s=o.validationBehaviour;o.validationBehaviour=function(e,n,t){r()&&s(e,n,t)}}else E.log.warn("Could not initialize postCode and City expansion, one or more fields/nodes were missing.")}var r,i;r=e.country&&"function"==typeof e.country.isValidCountry?e.country.isValidCountry:function(){return!0},i="function"==typeof e.valueSetCallback?e.valueSetCallback:function(){},n(e),t(e),o(e)}function StandardOxidAddressCheck(e,n,t,o,r,i,s,a){var d,e="string"==typeof e?E.$(e):e,u="string"==typeof n?E.$(n):n,l="string"==typeof t?E.$(t):t,c="string"==typeof o?E.$(o):o,f="string"==typeof r?E.$(r):r,p="string"==typeof i?E.$(i):i,C="string"==typeof s?E.$(s):s,g="function"==typeof a?a:function(){};if(e.length>0&&u.length>0&&l.length>0&&c.length>0&&f.length>0&&p.length>0&&1==C.length){var v=function(){if(e.length>0){if(""==e.val())return!0;if("a7c40f631fc920687.20179984"!=e.val())return!1}return!0};d=new E.Validation.StandardAddressCheck({pathToAccountingController:"?cl=enderecocontroller2",country:{node:e,isValidCountry:v},postCode:{node:u},city:{node:l},street:{node:c},streetNr:{node:f},saveButton:{node:p},form:{node:C},valueSetCallback:g})}else E.log.debug("Could not initialize StandardOxidAddressCheck, one or more of the required fields were missing.");return d}function StandardOxidInputAssistant(e,n,t,o,r,i,s,a,d){var e="string"==typeof e?E.$(e):e,u="string"==typeof n?E.$(n):n,l="string"==typeof t?E.$(t):t,c="string"==typeof r?E.$(r):r,f="string"==typeof i?E.$(i):i,p="string"==typeof s?E.$(s):s,C="string"==typeof a?E.$(a):a,g="string"==typeof o?E.$(o):l.parent(),v="function"==typeof d?d:function(){};if(u.length>0&&l.length>0&&c.length>0&&f.length>0&&p.length>0&&C.length>0){C.wrap('<div class="awesomplete"></div>'),"string"!=typeof E.Validation.genderInputType&&(E.Validation.genderInputType="select");var S=function(){return"select"==E.Validation.genderInputType?"MRS"==l.val():"radio"==E.Validation.genderInputType?"MRS"==l.filter(":checked").val():void 0},h=function(){return"select"==E.Validation.genderInputType?"MR"==l.val():"radio"==E.Validation.genderInputType?"MR"==l.filter(":checked").val():void 0},y=function(e){l.change(e)},A=function(){if(e.length>0){if(""==e.val())return!0;if("a7c40f631fc920687.20179984"!=e.val())return!1}return!0};E.Validation.StandardInputAssistant({gender:{node:l,nodeForErrorClass:g,isFemale:S,isMale:h,changeTrigger:y},firstName:{node:u},country:{node:e,isValidCountry:A},postCode:{node:c},city:{node:f},street:{node:p},valueSetCallback:v})}else E.log.debug("Could not initialize StandardOxidInputAssistant, one ore more of the required fields were missing.")}function UpperCaseName(e){function n(e){e.length>0&&e.on("blur",function(){var n=e.val();E.$(this).val(t(n))})}function t(e){e=e?e:"";for(var n=[],t=[" ","-","â€“","_","."],o=!0,r=0;r<e.length;r++)n.push(o?e[r].toUpperCase():e[r]),o=!1,t.indexOf(e[r])>=0&&(o=!0);return n=n.join(""),n.replace(/\s{2,}/g," ").trim()}if("string"==typeof e)e=E.$(e);else if("object"!=typeof e||"function"!=typeof e.val||"string"!=typeof e.val())return void E.log.error("UpperCaseName: The field for uppercase must be a input text field as either a css selector or a jQuery object.");n(e)}function CityExpansion(e,n){var t,o={service:"cityExpansion",city:e,fieldId:"noLongerUsed",transaction:"current",search:"0",sort:n?n:"0",callNo:function(){return E.getCommunicationService().getRequestSendCount()+1}},r={};return t=new E.ValidationType(r,o),t.formatRequest=function(e){return{orwellServiceData:JSON.stringify(e)}},t.processResponse=function(e){var n=JSON.parse(e);return{statuses:n.status,elements:n.elements}},t}function PostCodeExpansion(e,n){var t,o={service:"postCodeExpansion",fieldId:"noLongerUsed",postCode:e,transaction:"current",search:"0",sort:n?n:"0",callNo:function(){return E.getCommunicationService().getRequestSendCount()+1}},r={};return t=new E.ValidationType(r,o),t.formatRequest=function(e){return{orwellServiceData:JSON.stringify(e)}},t.processResponse=function(e){var n=JSON.parse(e);return{statuses:n.status,elements:n.elements}},t}function StreetExpansion(e,n,t,o){var r,i={service:"streetExpansion",fieldId:"noLongerUsed",postCode:n,city:t,street:e,transaction:"current",search:"0",sort:o?o:"0",callNo:function(){return E.getCommunicationService().getRequestSendCount()+1}},s={};return r=new E.ValidationType(s,i),r.formatRequest=function(e){return{orwellServiceData:JSON.stringify(e)}},r.processResponse=function(e){var n=JSON.parse(e);return{statuses:n.status,elements:n.elements}},r}function AddressCheck(e,n,t,o){var r,i={service:"addressCheck",fieldId:"noLongerUsed",postcode:e,city:n,street:t,housenumber:o,callNo:function(){return E.getCommunicationService().getRequestSendCount()+1}},s={};return r=new E.ValidationType(s,i),r.formatRequest=function(e){return{orwellServiceData:JSON.stringify(e)}},r.processResponse=function(e){var n=JSON.parse(e);return{statuses:n.status,elements:n.elements}},r}function FirstNameCheck(e,n){var t,o={service:"firstNameCheck",firstName:e,fieldId:"noLongerUsed",transaction:"new",search:"0",sort:n?n:"0",callNo:function(){return E.getCommunicationService().getRequestSendCount()+1}},r={};return t=new E.ValidationType(r,o),t.formatRequest=function(e){return{orwellServiceData:JSON.stringify(e)}},t.processResponse=function(e){var n=JSON.parse(e);return{statuses:n.status}},t}E.Validation={},E.Validation.checkUnchangedAddresses=!1,E.Validation.onValidationValueSet=function(e){},E.Validation.StandardAddressCheck=StandardAddressCheck,E.Validation.StandardInputAssistant=StandardInputAssistant,E.Validation.StandardOxidAddressCheck=StandardOxidAddressCheck,E.Validation.StandardOxidInputAssitant=StandardOxidInputAssistant,E.Validation.UpperCaseName=UpperCaseName,E.Validation.CityExpansion=CityExpansion,E.Validation.CityExpansionStatus={},E.Validation.PostCodeExpansion=PostCodeExpansion,E.Validation.PostCodeExpansionStatus={FOUND_ONE_POSTCODE_TOWN_COMBINATION:"A1000",FOUND_MULTIPLE_POSTCODE_TOWN_COMBINATIONS:"A2000",GOT_MAX_NUMBER_OF_RESULTS__RESULT_LIST_IS_INCOMPLETE:"A2100",POSTCODE_NOT_FOUND:"A3000",POSTCODE_NOT_FOUND2:"A3500",POSTCODE_INVALID:"A4000",MAJOR_FIELD_INVALID:"A4500",POSTCODE_CONTAINS_INVALID_SIGNS:"A4510",POSTCODE_EMPTY:"A4520",POSTCODE_TOO_LONG:"A4530"},E.Validation.StreetExpansion=StreetExpansion,E.Validation.StreetExpansionStatus={},E.Validation.AddressCheck=AddressCheck,E.Validation.AddressCheckStatus={ADDRESS_CORRECT:"A1000",ADDRESS_NORMED:"A1100",POSTCODE_NORMED:"A1130",CITY_NORMED:"A1140",STREET_NORMED:"A1160",STREET_NR_NORMED:"A1180",ADDRESS_OUTDATED:"A1200",POSTCODE_OUTDATED:"A1230",CITY_OUTDATED:"A1240",STREET_OUTDATED:"A1260",STREET_NR_OUTDATED:"A1280",ADDRESS_AUTOMATICALLY_CORRECTED:"A1300",ADDRESS_IS_CORRECTABLE:"A2000",ADDRESS_HAS_BEEN_CORRECTED:"A2100",ADDRESS_IS_TOO_AMBIGUOUS:"A3000",ADDRESS_COULD_NOT_BE_FOUND:"A4000",POSTCODE_COULD_NOT_BE_FOUND:"A4030",CITY_COULD_NOT_BE_FOUND:"A4040",STREET_COULD_NOT_BE_FOUND:"A4060",STREET_NR_COULD_NOT_BE_FOUND:"A4070"},E.Validation.FirstNameCheck=FirstNameCheck,E.Validation.FirstNameCheckStatus={FIRST_NAME_NOT_FOUND:"A2000",FIRST_NAME_FOUND:"A1000",FIRST_NAME_IS_MALE:"A1100",FIRST_NAME_IS_FEMALE:"A1200"};